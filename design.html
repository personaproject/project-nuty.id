<!DOCTYPE html>
<html lang="en">
  <head>
      <!--Font-->
      <link href='https://fonts.googleapis.com/css?family=Dekko' rel='stylesheet'>
      <link href='https://fonts.googleapis.com/css?family=Didact Gothic' rel='stylesheet'>
      <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
      <!--  -->
      <!--Linked CSS-->
    <link rel="stylesheet" href="asset/css/materialize.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@splidejs/splide@latest/dist/css/splide.min.css">
    <link rel="stylesheet" href="asset/css/animate.css">
    <link rel="stylesheet" href="asset/css/main.css">
    <!--SEO-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content='YOUR-KEYWORD-HERE' name='keywords'/>
    <meta content='AUTHOR-NAME-HERE' name='Author'/>
    <meta content='GOOGLE-META-TAG' name='google-site-verification'/>
    <meta content='BING-META-TAG' name='msvalidate.01'/>
    <meta content='ALEXA-META-TAG' name='alexaVerifyID'/>
    <!--Title and Icon-->
    <title>Nuty.ID</title>
    <link href="https://fonts.googleapis.com/css?family=Material+Icons|Material+Icons+Outlined|Material+Icons+Two+Tone|Material+Icons+Round|Material+Icons+Sharp" rel="stylesheet">
    
    <!--Additional CSS (for Developing only)-->
    
    </style>
  </head>
  <body>
    <header>                
    </header>
    
    <main>
      <div class="section h100 mid">
        
  <!-- Modal Trigger -->
  <button data-target="pesan-popup" class="btn modal-trigger">Pesan Sekarang!</button>

  <!-- Modal Structure -->
  <div id="pesan-popup" class="modal modal-fixed-footer">
    <div class="modal-content">
      <h4>Pesan Nuty Menu</h4>
      <form>
        <div class="row">
          <div class="input-field col s12">
            <input  id="name" type="text" class="validate">
          <label for="name">Nama Pemesan</label>
          </div>
          <div class="input-field col s12">
            <textarea id="addr" class="materialize-textarea"></textarea>
            <label for="addr">Alamat</label>
          </div>
          <div class="input-field col s12 l6">
            <select id="menu">
            </select>
            <label>Menu Name</label>
          </div>
          <div class="input-field col s9 l3">
            <select id="jenis">
              <option value="0">Loss</option>
              <option value="1">Maintain</option>
              <option value="2">Gain</option>
            </select>
            <label>Portion</label>
          </div>
          <div class="input-field col s3 l2">
            <input value="1" min="1" id="banyak" type="number" class="validate">
          <label for="banyak">Qty</label>
          </div>
          <div class="input-field col s4 offset-s4 l1">
            <div class="btn center" onclick="go()"><i class="material-icons">add_shopping_cart</i></div>
          </div>
        </div>
      </form>
      <h5 class="center">Pesanan</h5>
      <table id="pesanan" class="bordered centered">
        <thead>
          <tr>
            <th data-field="name">Item Name</th>
            <th data-field="portion">Portion</th>
            <th data-field="qty">Qty</th>
            <th data-field="price">Total Price</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
        </tbody>
      </table>
      <h5 id="total"class="right">Total 0</h5>
      <p>*Jika harga masih 0, harga belum ditentukan</p>
    </div>
    <div class="modal-footer">
      <a id="pesan-go" onclick="pesanGo()" class="modal-close waves-effect waves-green btn green white-text">Pesan</a>
    </div>
  </div>
          
      </div>
    </main>


    <script src="asset/js/materialize.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@splidejs/splide@latest/dist/js/splide.min.js"></script>
    <script src="asset/js/menu.js"></script>

    <script>

      document.addEventListener('DOMContentLoaded', function(){
        let modals = document.querySelectorAll(".modal");
        let initMod = M.Modal.init(modals, {});
        let selects = document.querySelectorAll("select");
        let initSelect = M.FormSelect.init(selects, {});
        M.updateTextFields();
      })   
     
      var pesan = [];
      var menu = document.getElementById("menu");
      for(i=0;i<jud.length;i++){
        let adding = document.createElement("option");
        adding.text = jud[i];
        adding.value= i;
        menu.options.add(adding);
      }
      function go(){
        let menu = document.getElementById("menu").value;
        let qty = document.getElementById("banyak").value;
        let port = document.getElementById("jenis").value;
        let pesenan = [menu, port, qty];
        let isIn = false;
        if(pesan.length > 0){
          for(i = 0; i < pesan.length; i++){
            if(pesan[i][0] == menu && pesan[i][1] == port){
              isIn = true;
              break;
            }
          }
          if(isIn){
            pesan[i][2] = (parseInt(pesan[i][2])+parseInt(qty)).toString();
          }else{
            pesan.push(pesenan)
          }
}else{
  pesan.push(pesenan);
}   
  
tampil();  
      }
function del(x){
  if(x == "all"){
    pesan = [];
  }else{
    pesan.splice(x, 1);}
    tampil();
  } 
  
    function tampil(){
        let tambahan ="";
        var tot =0;
        pesan.forEach(e=>{
          let harga = price[e[0]][e[1]]
        if(harga == "-"){
            harga = "0K";
          }
        let pricing = parseInt(harga.slice(0,harga.length-1))*1000*parseInt(e[2]);
        tot += pricing;
        tambahan += `
          <tr> 
          <td>${jud[e[0]]}</td>
          <td>${portion[e[1]]}</td>
          <td>${e[2]}</td>
          <td>${pricing}</td>
          <td><div class="btn red" onclick="del(${pesan.indexOf(e)})"><i class="material-icons">clear</i></div></td>
          </tr>
          `;
        })
        let htm = document.querySelector("#pesanan tbody");
        htm.innerHTML = tambahan;
        
        document.getElementById("total").innerHTML = `Total  ${tot}`
      }
      function pesanGo(){
        let m = M.Modal.getInstance(document.getElementById("pesan-popup"));
        let name = document.getElementById("name").value;
        let addr = document.getElementById("addr").value;
        console.log(pesan.length, m)
        if (pesan.length == 0){
          M.toast({html: 'Anda belum memesan!', classes : "red"})
        }else if(name == "" || addr == ""){
          M.toast({html: 'Data pesanan belum lengkap!', classes : "red"})
        }
        else{
        let date = new Date();
        
        let wrote = {
          pesanan : pesan,
          nama : name,
          tanggal : `${date.getDate()}-${date.getMonth()+1}-${date.getFullYear()}`,
          alamat : addr
        }
        let mySec = cipher("nuty");
        let ah = mySec(JSON.stringify(wrote))
        del("all");
        m.close();
        open(`https://api.whatsapp.com/send?phone=6289513218842&text=Hi%0AIni%20adalah%20pesanan%20saya%0Ahttps://personaproject.github.io/project-nuty.id/pesanan.html?id=${ah}&source=&data=&app_absent=`)
      }}
    </script>

  </body>
</html>
